{% from '/utils.html' import sharing_widget %}

{% if curr_mode and curr_mode != 'live' %}

    {% if can_admin() %}
        <div class="mode-selector col-md-2 col-sm-2">
            {% if curr_mode != 'new' %}
                {% include '/mode_dropdown.html' %}
            {% endif %}

            {% if curr_mode == 'record' or curr_mode == 'patch' %}
                <span class="size-counter size-counter-active">
                    <span class="left-buffer-md badge current-size" data-size="{{ info.size }}"></span>
                </span>
            {% endif %}
        </div>
    {% endif %}

    <div class="col-md-8 col-sm-8 {% if not can_admin() %}col-sm-offset-2{% endif %}">
        <form class="{{ 'content-form' if curr_mode != 'new' else 'start-recording' }} form-group-recorder-url">
            <div class="input-group containerized">
                <div class='input-group-btn'>
                    {% if curr_mode == 'replay' or curr_mode == 'replay-coll' %}
                        <button type="button" class="btn btn-default btn-prev"><span class='glyphicon glyphicon-chevron-left'></span></button>
                        <input type="text" id='page-display' class='form-control hidden-sm' value="-" />
                    {% endif %}

                    {% if can_admin() %}
                        {% include '/containerized_browser_select.html' %}
                    {% endif %}
                </div>

                {# wr url bar #}
                {% if curr_mode == 'replay' or curr_mode == 'replay-coll' %}
                    <div class='linklist'>
                        <input type='text' class="form-control dropdown-toggle" name="url" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" data-value-encoded="{{ url }}" data-target-decoded="value" value="" readonly/>
                        <ul class="dropdown-menu">
                            {% for rec in get_recs_for_coll() %}
                                <li>
                                    <div class='url' href='/{{ user }}/{{ coll }}/{{ rec.ts }}{% if browser %}$br:{{ browser }}{% endif %}/{{ rec.url }}'>{{ rec.url|trunc_url }}</div><span class='replay-date' data-date='{{ rec.ts }}'/>
                                </li>
                            {% endfor %}
                        </ul>
                        <span class='replay-date hidden-xs main-replay-date'></span>
                    </div>
                {% else %}
                    <input type="text" class="url-input-recorder form-control" name="url" data-value-encoded="{{ url }}" data-target-decoded="value" value="" {% if not browser %}autofocus{% endif %} required>
                {% endif %}

                {% if curr_mode == 'replay' or curr_mode == 'replay-coll' %}
                    <div class='input-group-btn'>
                        <button type="button" class="btn btn-default btn-next"><span class='glyphicon glyphicon-chevron-right'></span></button>
                    </div>
                {% endif %}
            </div>
        </form>

    </div>

    <div class="recording-actions text-center col-md-2 col-sm-2">
        {# needs implementation
        {% if can_admin() %}
            <button class="btn btn-default">
                <span class="glyphicon glyphicon-option-vertical" aria-hidden="true"></span>
            </button>
        {% endif %}
        #}

        {% if curr_mode != 'new' %}
            <button class="btn btn-default" title="Doesn't look right?" data-toggle="modal" data-target="#report-modal">
                <svg height="1792" viewBox="0 0 1792 1792" width="1792" xmlns="http://www.w3.org/2000/svg">
                    <path d="M1696 960q0 26-19 45t-45 19h-224q0 171-67 290l208 209q19 19 19 45t-19 45q-18 19-45 19t-45-19l-198-197q-5 5-15 13t-42 28.5-65 36.5-82 29-97 13v-896h-128v896q-51 0-101.5-13.5t-87-33-66-39-43.5-32.5l-15-14-183 207q-20 21-48 21-24 0-43-16-19-18-20.5-44.5t15.5-46.5l202-227q-58-114-58-274h-224q-26 0-45-19t-19-45 19-45 45-19h224v-294l-173-173q-19-19-19-45t19-45 45-19 45 19l173 173h844l173-173q19-19 45-19t45 19 19 45-19 45l-173 173v294h224q26 0 45 19t19 45zm-480-576h-640q0-133 93.5-226.5t226.5-93.5 226.5 93.5 93.5 226.5z"/>
                </svg>
            </button>
        {% endif %}

        {% if curr_mode != 'new' %}
            {{ sharing_widget(get_share_url(), get_embed_url(), coll_title, can_admin(), is_public(user, coll), anon=is_anon()) }}
        {% endif %}

        {% if can_admin() %}
            <form class="{{ 'content-action' if curr_mode != 'new' else 'start-recording' }}">
                <button type="submit" class="btn btn-default">
                    {{ 'Finish' if curr_mode != 'new' else 'Start' }}
                </button>
            </form>
        {% endif %}
    </div>

    {% if can_write() %}
    {% include 'snapshot_modal.html' %}
    {% endif %}

{% endif %}


